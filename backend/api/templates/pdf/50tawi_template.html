{% load humanize %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>หนังสือรับรองการหักภาษี ณ ที่จ่าย (50 ทวิ)</title>
    <style>
        /* A4 Page Setup */
        @page {
            size: A4;
            margin: 10mm; 
        }
        body {
            font-family: 'Sarabun', sans-serif; /* Must load Thai font in WeasyPrint */
            font-size: 11px;
            line-height: 1.3;
            color: #000;
        }
        
        /* Layout Utilities */
        .page-break { page-break-after: always; }
        .row { display: flex; width: 100%; }
        .col { flex: 1; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        .box-border { border: 1px solid #000; padding: 5px; margin-bottom: 5px; }
        
        /* Header */
        .header-title { font-size: 16px; font-weight: bold; text-align: center; margin-bottom: 10px; }
        .copy-label { font-size: 10px; text-align: right; position: absolute; top: 0; right: 0; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-bottom: 5px; }
        th, td { border: 0.5px solid #000; padding: 4px; vertical-align: top; }
        th { text-align: center; background-color: #f0f0f0; }
        .no-border-left { border-left: none; }
        .no-border-right { border-right: none; }
        .no-border-top { border-top: none; }
        .no-border-bottom { border-bottom: none; }
        
        /* Specific Columns */
        .col-date { width: 80px; text-align: center; }
        .col-amount { width: 100px; text-align: right; }
        .col-tax { width: 80px; text-align: right; }
        
        /* Checkbox simulation */
        .checkbox { 
            display: inline-block; width: 12px; height: 12px; border: 1px solid #000; 
            margin-right: 5px; text-align: center; line-height: 10px; font-size: 10px;
        }
        .checked::after { content: "✓"; font-weight: bold; }

    </style>
</head>
<body>

{% for copy_name in "12" %} 
<div class="page-container {% if forloop.first %}page-break{% endif %}">
    
    <div style="position: relative; height: 30px;">
        <div class="copy-label">
            ฉบับที่ {{ forloop.counter }} 
            {% if forloop.counter == 1 %}
                (สำหรับผู้ถูกหักภาษี ณ ที่จ่าย ใช้แนบพร้อมกับแบบแสดงรายการภาษี)
            {% else %}
                (สำหรับผู้ถูกหักภาษี ณ ที่จ่าย เก็บไว้เป็นหลักฐาน)
            {% endif %}
        </div>
    </div>

    <div class="header-title">หนังสือรับรองการหักภาษี ณ ที่จ่าย</div>
    
    <div class="text-right" style="margin-bottom: 5px;">
        เล่มที่ {{ cert.book_number }} เลขที่ {{ cert.cert_number }}
    </div>

    <div class="box-border">
        <div class="bold">ผู้มีหน้าที่หักภาษี ณ ที่จ่าย:</div>
        <div>ชื่อ: {{ company.name }}</div>
        <div>เลขประจำตัวผู้เสียภาษีอากร: {{ company.tax_id }}</div>
        <div>ที่อยู่: {{ company.address }}</div>
    </div>

    <div class="box-border">
        <div class="bold">ผู้ถูกหักภาษี ณ ที่จ่าย:</div>
        <div>ชื่อ: {{ vendor.name }}</div>
        <div>เลขประจำตัวผู้เสียภาษีอากร: {{ vendor.tax_id }}</div>
        <div>ที่อยู่: {{ vendor.address|default:"-" }}</div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ประเภทเงินได้</th>
                <th class="col-date">วัน เดือน ปี<br>ที่จ่าย</th>
                <th class="col-amount">จำนวนเงิน<br>ที่จ่าย</th>
                <th class="col-tax">ภาษีที่หัก<br>และนำส่งไว้</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1. เงินเดือน ค่าจ้าง เบี้ยเลี้ยง โบนัส ฯลฯ</td>
                <td class="text-center">{% if cert.income_type == '1' %}{{ cert.date_issued|date:"d/m/Y" }}{% endif %}</td>
                <td class="text-right">{% if cert.income_type == '1' %}{{ cert.amount_before_tax|intcomma }}{% endif %}</td>
                <td class="text-right">{% if cert.income_type == '1' %}{{ cert.tax_amount|intcomma }}{% endif %}</td>
            </tr>
            <tr>
                <td>2. ค่าธรรมเนียม ค่านายหน้า ฯลฯ</td>
                <td class="text-center">{% if cert.income_type == '2' %}{{ cert.date_issued|date:"d/m/Y" }}{% endif %}</td>
                <td class="text-right">{% if cert.income_type == '2' %}{{ cert.amount_before_tax|intcomma }}{% endif %}</td>
                <td class="text-right">{% if cert.income_type == '2' %}{{ cert.tax_amount|intcomma }}{% endif %}</td>
            </tr>
            <tr>
                <td>3. ค่าแห่งลิขสิทธิ์ ฯลฯ</td>
                <td class="text-center">{% if cert.income_type == '3' %}{{ cert.date_issued|date:"d/m/Y" }}{% endif %}</td>
                <td class="text-right">{% if cert.income_type == '3' %}{{ cert.amount_before_tax|intcomma }}{% endif %}</td>
                <td class="text-right">{% if cert.income_type == '3' %}{{ cert.tax_amount|intcomma }}{% endif %}</td>
            </tr>
            <tr>
                <td>
                    (ก) ค่าจ้างทำของ ค่าบริการ (40(7), 40(8))<br>
                    (ข) ค่าเช่า (40(5))<br>
                    (ค) ค่าขนส่ง (40(8))<br>
                    (ง) อื่นๆ ระบุ: {{ cert.income_description }}
                </td>
                <td class="text-center">
                    {% if cert.income_type in '5,6,7,8' %}
                        {{ cert.date_issued|date:"d/m/Y" }}
                    {% endif %}
                </td>
                <td class="text-right">
                    {% if cert.income_type in '5,6,7,8' %}
                        {{ cert.amount_before_tax|intcomma }}
                    {% endif %}
                </td>
                <td class="text-right">
                    {% if cert.income_type in '5,6,7,8' %}
                        {{ cert.tax_amount|intcomma }}
                    {% endif %}
                </td>
            </tr>

            <tr class="bold" style="background-color: #f0f0f0;">
                <td class="text-right">รวมเงินที่จ่ายและภาษีที่หักนำส่ง</td>
                <td></td>
                <td class="text-right">{{ cert.amount_before_tax|intcomma }}</td>
                <td class="text-right">{{ cert.tax_amount|intcomma }}</td>
            </tr>
            <tr>
                <td colspan="4">
                    <strong>รวมเงินภาษีที่หักนำส่ง (ตัวอักษร):</strong> 
                    ({{ cert.tax_amount|intcomma }} บาท) 
                </td>
            </tr>
        </tbody>
    </table>

    <div class="box-border">
        เงินที่จ่ายเข้า กบข. / กสจ. / กองทุนสงเคราะห์ครูโรงเรียนเอกชน ... (ถ้ามี): ___________ บาท
    </div>

    <div class="row" style="margin-top: 10px;">
        <div class="col box-border">
            <div class="bold">ผู้มีหน้าที่หักภาษี ณ ที่จ่าย:</div>
            
            <div style="margin: 5px 0;">
                <span class="checkbox checked"></span> (1) หัก ณ ที่จ่าย
            </div>
            <div style="margin: 5px 0;">
                <span class="checkbox"></span> (2) ออกให้ตลอดไป
            </div>
            <div style="margin: 5px 0;">
                <span class="checkbox"></span> (3) ออกให้ครั้งเดียว
            </div>
        </div>
        
        <div class="col box-border text-center">
            <br>
            ขอรับรองว่าข้อความและตัวเลขข้างต้นถูกต้องตรงความจริงทุกประการ
            <br><br><br>
            ..................................................................................
            <br>
            ( {{ company.name }} )
            <br>
            ผู้มีหน้าที่หักภาษี ณ ที่จ่าย
            <br>
            {{ cert.date_issued|date:"d/m/Y" }}
        </div>
    </div>

</div>
{% endfor %}

</body>
</html>