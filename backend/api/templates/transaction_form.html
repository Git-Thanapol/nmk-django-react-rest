{% extends 'base.html' %}

{% block content %}



        
            <!-- Transaction Entry Form -->
            <div class="card rounded-xl p-3 main-card">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="mb-0">Transaction Entry</h5>
                </div>

                <!-- Transaction Type -->
                <div class="row g-3 align-items-center mb-4">
                    <div class="col-auto">
                        <label class="form-label fw-semibold">รายการ (I/C/H/T/X):</label>
                    </div>
                    <div class="col-auto">
                        <div class="btn-group" role="group" aria-label="transaction-type">
                            <input type="radio" class="btn-check" name="transaction_type" id="type1" required>
                            <label class="btn btn-ghost btn-sm" for="type1">ลูกหนี้</label>
                            
                            <input type="radio" class="btn-check" name="transaction_type" id="type2" required>
                            <label class="btn btn-ghost btn-sm" for="type2">เงินสด</label>
                            
                            <input type="radio" class="btn-check" name="transaction_type" id="type3" required>
                            <label class="btn btn-ghost btn-sm" for="type3">เช็ค</label>
                            
                            <input type="radio" class="btn-check" name="transaction_type" id="type4" required>
                            <label class="btn btn-ghost btn-sm" for="type4">บัตรเครดิต</label>
                            
                            <input type="radio" class="btn-check" name="transaction_type" id="type5" required>
                            <label class="btn btn-ghost btn-sm" for="type5">อื่นๆ</label>
                        </div>
                    </div>
                </div>

                <!-- Main Form Fields -->
                <form method="post" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <div class="row g-3">
                        <!-- Row 1 -->
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">วันที่ *</label>
                            <input type="date" class="form-control" name="transaction_date" value="2025-10-02" required>
                            <div class="invalid-feedback">กรุณาระบุวันที่</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">เลขที่ใบกำกับ *</label>
                            <input type="text" class="form-control" name="invoice_number" value="681001-004" required>
                            <div class="invalid-feedback">กรุณาระบุเลขที่ใบกำกับ</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">รหัสลูกค้า *</label>
                            <input type="text" class="form-control" name="customer_code" value="S5001" required>
                            <div class="invalid-feedback">กรุณาระบุรหัสลูกค้า</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">บัญชีแยกประเภท *</label>
                            <input type="text" class="form-control" name="account_code" value="1010" required>
                            <div class="invalid-feedback">กรุณาระบุบัญชีแยกประเภท</div>
                        </div>

                        <!-- Row 2 -->
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">จำนวนเงิน *</label>
                            <input type="number" class="form-control input-number" name="amount" value="100000.00" step="0.01" required>
                            <div class="invalid-feedback">กรุณาระบุจำนวนเงิน</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">ส่วนลดพิเศษ *</label>
                            <input type="number" class="form-control input-number" name="special_discount" value="0.00" step="0.01" required>
                            <div class="invalid-feedback">กรุณาระบุส่วนลดพิเศษ</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">ภาษีขาย *</label>
                            <div class="input-group">
                                <input type="number" class="form-control input-number" name="tax_rate" value="7.00" step="0.01" required>
                                <span class="input-group-text bg-transparent text-secondary border-secondary">%</span>
                            </div>
                            <div class="invalid-feedback">กรุณาระบุภาษีขาย</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">วันที่ครบกำหนด *</label>
                            <input type="date" class="form-control" name="due_date" value="2025-10-02" required>
                            <div class="invalid-feedback">กรุณาระบุวันที่ครบกำหนด</div>
                        </div>

                        <!-- Row 3 -->
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">พนักงานขาย *</label>
                            <input type="text" class="form-control" name="sales_person" required>
                            <div class="invalid-feedback">กรุณาระบุพนักงานขาย</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">หมายเหตุ *</label>
                            <input type="text" class="form-control" name="notes" required>
                            <div class="invalid-feedback">กรุณาระบุหมายเหตุ</div>
                        </div>
                    </div>

                    <!-- Company Info and Totals -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="p-3 rounded-xl border" style="border-color:var(--stroke)">
                                <h6 class="fw-semibold mb-3">Intrepid Ecommerce Services (Thailand) Co., Ltd.</h6>
                                <div class="mb-2">
                                    <strong>เงินสด</strong>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="fw-semibold">ยอดเงินสุทธิ =</div>
                                    <div class="fw-bold fs-5 net-amount">100,000.00</div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="fw-semibold">รวมเป็นเงิน =</div>
                                    <div class="fw-bold fs-5 grand-total">107,000.00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="sticky-actions d-flex gap-2 p-3 mt-4 rounded-bottom">
                        <button type="submit" class="btn btn-brand">
                            <i class="bi bi-check2 me-2"></i>บันทึก
                        </button>
                        <button type="reset" class="btn btn-outline-danger">
                            <i class="bi bi-x-circle me-2"></i>ยกเลิก
                        </button>
                        <button type="button" class="btn btn-outline-secondary">
                            <i class="bi bi-box-arrow-left me-2"></i>ออก
                        </button>
                    </div>
                </form>
            </div>

            <!-- Transaction History Table -->
            <div class="card rounded-xl p-3 mt-4">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="mb-0">Transaction History</h5>
                </div>

                <div class="table-responsive">
                    <table class="table table-darkish table-bordered align-middle mb-0">
                        <thead>
                            <tr>
                                <th class="text-center">วันที่</th>
                                <th class="text-center">CD</th>
                                <th class="text-center">เลขที่ใบกำกับ</th>
                                <th class="text-center">รหัสบัญชี</th>
                                <th class="text-center">รหัสลูกค้า</th>
                                <th class="text-center">รวมเป็นเงิน</th>
                                <th class="text-center">หมายเหตุ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="text-center">02/10/2568</td>
                                <td class="text-center">D</td>
                                <td class="text-center">681001-001</td>
                                <td class="text-center">1010</td>
                                <td class="text-center">S5001</td>
                                <td class="text-end">50,000.00</td>
                                <td class="text-center">-</td>
                            </tr>
                            <tr>
                                <td class="text-center">01/10/2568</td>
                                <td class="text-center">C</td>
                                <td class="text-center">681001-002</td>
                                <td class="text-center">1010</td>
                                <td class="text-center">S5002</td>
                                <td class="text-end">75,000.00</td>
                                <td class="text-center">ส่วนลด 5%</td>
                            </tr>
                            <tr>
                                <td class="text-center">30/09/2568</td>
                                <td class="text-center">D</td>
                                <td class="text-center">681001-003</td>
                                <td class="text-center">1010</td>
                                <td class="text-center">S5003</td>
                                <td class="text-end">120,000.00</td>
                                <td class="text-center">วางบิล</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        
 


<script>
    // Form validation and calculation
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.needs-validation');
        const amountInput = document.querySelector('input[name="amount"]');
        const taxRateInput = document.querySelector('input[name="tax_rate"]');
        const discountInput = document.querySelector('input[name="special_discount"]');
        const netAmountElement = document.querySelector('.net-amount');
        const grandTotalElement = document.querySelector('.grand-total');

        // Calculate totals
        function calculateTotals() {
            const amount = parseFloat(amountInput.value) || 0;
            const discount = parseFloat(discountInput.value) || 0;
            const taxRate = parseFloat(taxRateInput.value) || 0;
            
            const netAmount = amount - discount;
            const taxAmount = (netAmount * taxRate) / 100;
            const grandTotal = netAmount + taxAmount;
            
            netAmountElement.textContent = netAmount.toLocaleString('th-TH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            grandTotalElement.textContent = grandTotal.toLocaleString('th-TH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Add event listeners for calculation
        [amountInput, taxRateInput, discountInput].forEach(input => {
            input.addEventListener('input', calculateTotals);
        });

        // Initial calculation
        calculateTotals();

        // Form validation
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });

        // Radio button validation
        const radioButtons = document.querySelectorAll('input[name="transaction_type"]');
        const radioGroup = document.querySelector('.btn-group');
        
        radioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                if (Array.from(radioButtons).some(rb => rb.checked)) {
                    radioGroup.classList.remove('is-invalid');
                }
            });
        });

        // Custom radio button validation
        form.addEventListener('submit', function(event) {
            const isRadioSelected = Array.from(radioButtons).some(rb => rb.checked);
            if (!isRadioSelected) {
                event.preventDefault();
                event.stopPropagation();
                radioGroup.classList.add('is-invalid');
            } else {
                radioGroup.classList.remove('is-invalid');
            }
        });
    });
</script>

<style>
    .btn-group.is-invalid {
        border: 1px solid #dc3545;
        border-radius: 0.375rem;
        padding: 1px;
    }
    
    .input-number {
        text-align: right;
    }
    
    /* Ensure all form controls have consistent styling */
    .form-control:required, .form-select:required {
        border-left: 3px solid #3b5998;
    }
    
    .btn-ghost {
        background-color: transparent;
        border: 1px solid #495057;
        color: #adb5bd;
    }
    
    .btn-ghost:hover, .btn-check:checked + .btn-ghost {
        background-color: var(--brand-color);
        border-color: var(--brand-color);
        color: #fff;
    }
</style>
{% endblock %}