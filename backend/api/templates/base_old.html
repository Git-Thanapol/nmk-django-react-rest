<!DOCTYPE html>
<html lang="th" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NAMKANG • Accounting System</title>

    <!-- Google Fonts with Thai support -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --brand-color: #3b5998;
        --stroke: #444;
        --sidebar-width: 280px;
        --topbar-height: 70px;
      }

      body {
        font-family: "Sarabun", sans-serif;
        background-color: #1a1a1a;
        color: #e9ecef;
        overflow-x: hidden;
      }

      /* App Layout */
      .app {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar Styles */
      .sidebar {
        width: var(--sidebar-width);
        background-color: #212529;
        border-right: 1px solid var(--stroke);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
      }

      .brand {
        color: #fff;
        font-weight: 600;
      }

      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
      }

      .nav-link {
        color: #adb5bd;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
      }

      .nav-link:hover,
      .nav-link.active {
        color: #fff;
        background-color: var(--brand-color);
      }

      .muted {
        color: #6c757d;
      }

      /* Main Content */
      main {
        flex: 1;
        margin-left: var(--sidebar-width);
        width: calc(100% - var(--sidebar-width));
      }

      .topbar {
        height: var(--topbar-height);
        background-color: #212529;
        border-bottom: 1px solid var(--stroke);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .content {
        padding: 1.5rem;
        min-height: calc(100vh - var(--topbar-height));
      }

      /* Card Styles */
      .card {
        background-color: #212529;
        border: 1px solid var(--stroke);
      }

      .rounded-xl {
        border-radius: 0.75rem;
      }

      /* Form Controls */
      .form-control,
      .form-select {
        background-color: #2b3035;
        border: 1px solid #495057;
        color: #e9ecef;
      }

      .form-control:focus,
      .form-select:focus {
        background-color: #2b3035;
        border-color: var(--brand-color);
        color: #e9ecef;
        box-shadow: 0 0 0 0.25rem rgba(59, 89, 152, 0.25);
      }

      /* Button Styles */
      .btn-ghost {
        background-color: transparent;
        border: 1px solid #495057;
        color: #adb5bd;
      }

      .btn-ghost:hover,
      .btn-check:checked + .btn-ghost {
        background-color: var(--brand-color);
        border-color: var(--brand-color);
        color: #fff;
      }

      .btn-brand {
        background-color: var(--brand-color);
        border-color: var(--brand-color);
        color: #fff;
      }

      .btn-brand:hover {
        background-color: #2d4373;
        border-color: #2d4373;
      }

      /* Table Styles */
      .table-darkish {
        background-color: #212529;
        color: #e9ecef;
      }

      .table-darkish th,
      .table-darkish td {
        border-color: #495057;
      }

      .table-darkish thead th {
        background-color: #2b3035;
        border-bottom: 2px solid #495057;
      }

      /* Sticky Actions */
      .sticky-actions {
        background-color: #212529;
        border-top: 1px solid var(--stroke);
        position: sticky;
        bottom: 0;
      }

      /* Input Number Styles */
      .input-number {
        text-align: right;
      }

      /* Responsive Adjustments */
      @media (max-width: 992px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .sidebar.show {
          transform: translateX(0);
        }

        main {
          margin-left: 0;
          width: 100%;
        }

        .menu-toggle {
          display: block;
        }
      }

      @media (max-width: 768px) {
        .content {
          padding: 1rem;
        }

        .table-responsive {
          font-size: 0.875rem;
        }

        .sticky-actions {
          position: relative;
        }
      }

      /* Menu Toggle (for mobile) */
      .menu-toggle {
        display: none;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 1100;
        background-color: var(--brand-color);
        border: none;
        border-radius: 0.375rem;
        color: white;
        width: 40px;
        height: 40px;
      }

      /* Close button for sidebar */
      .sidebar-close {
        display: none;
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        color: #adb5bd;
        font-size: 1.5rem;
      }

      @media (max-width: 992px) {
        .menu-toggle,
        .sidebar-close {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="menuToggle">
      <i class="bi bi-list"></i>
    </button>

    <div class="app">
      <!-- Sidebar -->
      <aside class="sidebar p-3 d-flex flex-column">
        <button class="sidebar-close" id="sidebarClose">
          <i class="bi bi-x-lg"></i>
        </button>

        <div class="d-flex align-items-center gap-2 mb-4">
          <div class="brand h5 mb-0">Namkang Phone</div>
        </div>

        <div class="d-flex align-items-center gap-2 mb-4">
          <img
            class="avatar"
            src="https://ui-avatars.com/api/?name=NAME&background=3b5998&color=ffffff&size=128&rounded=true"
            alt="avatar"
          />
          {% if user.is_authenticated %}
          <div>
            <div class="fw-semibold">Account</div>
            <div class="muted small">Administrator</div>
          </div>
          {% else %}
          <div>
            <div class="fw-semibold">บัญชี</div>
            <div class="muted small">Administrator</div>
          </div>
          {% endif %}
        </div>

        <hr />

        <nav class="nav nav-pills flex-column gap-1">
          <a
            class="nav-link {% if request.path == '/purchase_form/' %}active{% endif %}"
            href="{% url 'purchase_form' %}"
          >
            <i class="bi bi-cart me-2"></i>รายการซื้อเข้า
          </a>
          <a
            class="nav-link {% if request.path == '/invoice_form/' %}active{% endif %}"
            href="{% url 'invoice_form' %}"
          >
            <i class="bi bi-receipt me-2"></i>รายการขาย
          </a>
          <a
            class="nav-link {% if request.path == '/transaction_form/' %}active{% endif %}"
            href="{% url 'transaction_form' %}"
          >
            <i class="bi bi-graph-up me-2"></i>ค่าใช้จ่ายอื่นๆ
          </a>
          <a 
            class="nav-link {% if request.path == '/transaction_form/' %}active{% endif %}">
            <i class="bi bi-file-person-fill me-2"></i>ผู้ซื้อ
          </a>
          <a class="nav-link" href="income-expenses.html">
            <i class="bi bi-person-lines-fill me-2"></i>ผู้ขาย
          </a>
          <a class="nav-link" href="items.html">
            <i class="bi bi-phone me-2"></i>สินค้าและบริการ
          </a>
          <a class="nav-link" href="settings.html">
            <i class="bi bi-gear me-2"></i>ตั้งค่า
          </a>
          <a class="nav-link" href="platforms.html">
            <i class="bi bi-layers me-2"></i>Platforms
          </a>
          <hr />
          <a class="nav-link {% if request.path == '/help/' %}active{% endif %}"
              href="{% url 'help' %}">
            <i class="bi bi-question-circle me-2"></i>Help
          </a>
          <a
            class="nav-link"
            href="{% url 'logout' %}"
            onclick="return confirm('ต้องการออกจากระบบหรือไม่?');"
          >
            <i class="bi bi-box-arrow-right me-2"></i>ออกจากระบบ
          </a>
        </nav>
      </aside>

      <!-- Main -->
      <main class="d-flex flex-column">
        <div
          class="topbar d-flex align-items-center justify-content-between px-4 py-3"
        >
          <div class="h5 mb-0">Purchase</div>
        </div>

        <div class="content">
          {% block content %} {% endblock %}
        </div>
      </main>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Mobile sidebar toggle
      document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.getElementById("menuToggle");
        const sidebarClose = document.getElementById("sidebarClose");
        const sidebar = document.querySelector(".sidebar");

        menuToggle.addEventListener("click", function () {
          sidebar.classList.add("show");
        });

        sidebarClose.addEventListener("click", function () {
          sidebar.classList.remove("show");
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener("click", function (event) {
          if (window.innerWidth <= 992) {
            const isClickInsideSidebar = sidebar.contains(event.target);
            const isClickOnMenuToggle = menuToggle.contains(event.target);

            if (
              !isClickInsideSidebar &&
              !isClickOnMenuToggle &&
              sidebar.classList.contains("show")
            ) {
              sidebar.classList.remove("show");
            }
          }
        });

        // Auto-calculate line totals
        const inputs = document.querySelectorAll(".qty, .price, .discount");
        inputs.forEach((input) => {
          input.addEventListener("input", calculateLineTotal);
        });

        function calculateLineTotal() {
          const row = this.closest("tr");
          const qty = parseFloat(row.querySelector(".qty").value) || 0;
          const price = parseFloat(row.querySelector(".price").value) || 0;
          const discount =
            parseFloat(row.querySelector(".discount").value) || 0;

          const lineTotal = qty * price - discount;
          row.querySelector(".line-total").textContent = lineTotal.toFixed(2);
        }
      });
    </script>
  </body>
</html>
